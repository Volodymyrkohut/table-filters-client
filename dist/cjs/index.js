"use strict";var me=Object.create;var P=Object.defineProperty;var ce=Object.getOwnPropertyDescriptor;var ue=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,fe=Object.prototype.hasOwnProperty;var ye=(e,t)=>{for(var o in t)P(e,o,{get:t[o],enumerable:!0})},Y=(e,t,o,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of ue(t))!fe.call(e,i)&&i!==o&&P(e,i,{get:()=>t[i],enumerable:!(r=ce(t,i))||r.enumerable});return e};var m=(e,t,o)=>(o=e!=null?me(de(e)):{},Y(t||!e||!e.__esModule?P(o,"default",{value:e,enumerable:!0}):o,e)),Fe=e=>Y(P({},"__esModule",{value:!0}),e);var he={};ye(he,{TableFiltersClient:()=>L});module.exports=Fe(he);var d=m(require("react"));var v=require("formik");var a=m(require("yup")),E=e=>e?.map(t=>t.value),F={required:"Required",date:"Should be valid date format",string:"Should be valid string",number:"Should be valid number"},Re=a.object().shape({filters:a.array().of(a.object().shape({id:a.object().shape({label:a.string().required(),value:a.string().required(),type:a.string().required()}).nullable().required(F.required),values:a.array().when("id",{is:e=>e.type==="number",then:a.array().transform(e=>E(e)).of(a.number().typeError(F.number)).required(F.required)}).when("id",{is:e=>e.type==="date",then:a.array().transform(e=>E(e)).of(a.date().typeError(F.date)).required(F.required)}).when("id",{is:e=>e.type!=="date"&&e.type!=="number",then:a.array().transform(e=>E(e)).of(a.number().typeError(F.string)).required(F.required)}),operator:a.string().nullable().required(F.required)}))}),N=Re;var f=m(require("react"));var T=m(require("react"));var w="number",V="string",D="boolean",q="date",_="enum",U="source";var A=m(require("react")),$=require("formik");var S=m(require("react"));var k=m(require("classnames")),be=e=>{let{children:t,label:o="",isError:r,error:i}=e,n=(0,k.default)("field-control",{isError:r});return S.createElement("div",{className:n},o&&S.createElement("label",null,o),t,S.createElement("span",{className:"field-control__error"},r&&S.createElement("span",null,i)))},R=be;var M=m(require("react")),B=require("react-select-async-paginate"),ve=e=>{let{...t}=e;return M.createElement(B.AsyncPaginate,{additional:{page:1},...t})},H=ve;var Se=e=>{let{name:t,label:o,onChange:r,...i}=e;return A.createElement($.Field,{name:t},n=>{let{field:u,meta:l,form:s}=n,c=l.touched&&!!l.error;return A.createElement(R,{isError:c,error:l.error,label:o},A.createElement(H,{...i,...u,onBlur:()=>s.setFieldTouched(t,!0),onChange:p=>{r&&r(p),s.setFieldValue(t,p)}}))})},W=Se;var g=m(require("react")),J=require("formik");var j=m(require("react")),z=m(require("react-select/async-creatable")),Te=function(e){let{options:t,isError:o,...r}=e;return j.createElement(z.default,{defaultOptions:t,...r})},G=Te;var Ie=e=>{let{name:t,label:o,onChange:r,...i}=e;return g.createElement(J.Field,{name:t},n=>{let{field:u,meta:l,form:s}=n,c=l.touched&&!!l.error;return g.createElement(R,{isError:c,error:l.error,label:o},g.createElement(G,{...i,...u,onBlur:()=>s.setFieldTouched(t,!0),onChange:p=>{r&&r(p),s.setFieldValue(t,p)}}))})},b=Ie;var Ce=({type:e,name:t,valueOptions:o,loadOptions:r})=>{switch(e){case U:return T.createElement(W,{name:t,isMulti:!0,loadOptions:r});case(V||D||q||_||w):return T.createElement(b,{name:t,isMulti:!0});case _:return T.createElement(b,{name:t,options:o,isMulti:!0});default:return T.createElement(b,{name:t,isMulti:!0})}},K=Ce;var I=m(require("react")),Z=require("formik");var x=m(require("react")),Q=m(require("classnames")),Oe=e=>{let{isError:t,children:o,...r}=e,i=(0,Q.default)("select",{isError:t});return x.default.createElement("div",{className:i},x.default.createElement("select",{autoComplete:"off",...r},o))},X=Oe;var Pe=e=>{let{name:t,options:o=[],disabled:r,label:i,id:n}=e;return I.createElement(Z.Field,{name:t},u=>{let{field:l,meta:s}=u,c=s.touched&&!!s.error;return I.createElement(R,{isError:c,error:s.error,label:i},I.createElement(X,{id:n,...l,isError:c,disabled:r},o.map(p=>I.createElement("option",{key:p.value,value:p.value},p.key))))})},ee=Pe;var Ae=e=>{let{idOptions:t,loadOptions:o,operatorOptions:r,filterType:i,valueOptions:n,onRemove:u,onChangeIdSelect:l,index:s}=e;return f.createElement("div",{className:"filter-row"},f.createElement("div",{className:"filter-row__field filter-row__field__id"},f.createElement(b,{name:`filters[${s}].id`,options:t,onChange:l})),f.createElement("div",{className:"filter-row__field filter-row__field__operator"},f.createElement(ee,{name:`filters[${s}].operator`,options:r})),f.createElement("div",{className:"filter-row__field filter-row__field__values"},f.createElement(K,{name:`filters[${s}].values`,type:i,valueOptions:n,loadOptions:o})),f.createElement("div",{className:"filter-row__field filter-row__remove"},f.createElement("button",{type:"button",onClick:()=>u(s)},"\u0432\u0438\u0434\u0430\u043B\u0438\u0442\u0438")))},te=Ae;var re=(e,t)=>({filters:e.filters?.length?e.filters.map(r=>{let i=t.find(n=>r.id.value===n.value);return{values:r.values,operator:r.operator,id:i}}):[]}),oe=e=>e.map(t=>{let{caption:o,id:r,values:i,operators:n,...u}=t,l;Array.isArray(i)?l=i.map(c=>({label:c.name,value:String(c.id)})):l=i;let s=n.map(c=>({key:c,value:c}));return{label:o,value:String(r),values:l,operators:[{key:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440",value:""},...s],...u}}),ie=e=>({filters:e.filters.map(r=>{let{id:i,...n}=r;return{...n,id:{label:i.label,value:i.value}}})});var ge=e=>{let{onSubmitFilterForm:t,initialFilters:o,filtersTypesList:r,onRemoveFilter:i,onAddFilter:n,onLoadSourceOptions:u}=e,l=oe(r),s=re(o,l);return d.createElement(v.Formik,{onSubmit:(p,C)=>{let h=ie(p);t&&t(h)},initialValues:s,validationSchema:N,enableReinitialize:!0},d.createElement(v.Form,null,d.createElement(v.FieldArray,{name:"filters"},p=>{let{form:C,push:h,remove:ae}=p,{filters:le}=C.values,ne=y=>{ae(y),i&&i(y)},se=()=>{let[y=null]=l;h({id:y,operator:"",values:[]}),n&&n(p)};return d.createElement("div",{className:"filter-list"},d.createElement("ul",{className:"filter-list__items"},le.map((y,O)=>{let pe=()=>{C.setFieldValue(`filters[${O}].operator`,""),C.setFieldValue(`filters[${O}].values`,null)};return d.createElement("li",{className:"filter-list__item",key:O},d.createElement(te,{loadOptions:u(y?.id?.value),filterType:y?.id?.type,onChangeIdSelect:pe,idOptions:l,operatorOptions:y?.id?.operators,valueOptions:y?.id?.values,onRemove:ne,index:O}))})),d.createElement("div",{className:"filter-list__button"},d.createElement("button",{type:"button",onClick:se},"add one more filter")))}),d.createElement("button",{type:"submit"},"\u0417\u0430\u0441\u0442\u0443\u0441\u0443\u0432\u0430\u0442\u0438 \u0444\u0456\u043B\u044C\u0442\u0440")))},L=ge;
//# sourceMappingURL=index.js.map
