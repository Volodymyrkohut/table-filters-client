import*as d from"react";import{FieldArray as de,Form as ue,Formik as fe}from"formik";import*as p from"yup";var J=p.object().shape({filters:p.array().of(p.object().shape({id:p.object().shape({label:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),value:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F")}).nullable().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),values:p.array().of(p.object().shape({label:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),value:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F")})).nullable().min(1,"\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F").required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),operator:p.string().nullable().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F")}))}),x=J;import*as u from"react";import*as S from"react";import{Field as ee}from"formik";import*as h from"react";import K from"react-select/async-creatable";var Q=function(r){let{options:e,isError:i,...t}=r;return h.createElement(K,{defaultOptions:e,...t})},L=Q;import*as v from"react";import X from"classnames";var Z=r=>{let{children:e,label:i="",isError:t,error:o}=r,n=X("field-control",{isError:t});return v.createElement("div",{className:n},i&&v.createElement("label",null,i),e,v.createElement("span",{className:"field-control__error"},t&&v.createElement("span",null,o)))},F=Z;var te=r=>{let{name:e,label:i,onChange:t,...o}=r;return S.createElement(ee,{name:e},n=>{let{field:c,meta:a,form:l}=n,m=a.touched&&!!a.error;return S.createElement(F,{isError:m,error:a.error,label:i},S.createElement(L,{...o,...c,onBlur:()=>l.setFieldTouched(e,!0),onChange:s=>{t&&t(s),l.setFieldValue(e,s)}}))})},y=te;import R from"react";import{Field as ie}from"formik";import N from"react";import re from"classnames";var oe=r=>{let{isError:e,children:i,...t}=r,o=re("select",{isError:e});return N.createElement("div",{className:o},N.createElement("select",{autoComplete:"off",...t},i))},Y=oe;var ae=r=>{let{name:e,options:i=[],disabled:t,label:o,id:n}=r;return R.createElement(ie,{name:e},c=>{let{field:a,meta:l}=c,m=l.touched&&!!l.error;return R.createElement(F,{isError:m,error:l.error,label:o},R.createElement(Y,{id:n,...a,isError:m,disabled:t},i.map(s=>R.createElement("option",{key:s.value,value:s.value},s.key))))})},w=ae;import g from"react";var V="number",M="string",k="boolean",D="date",_="enum",U="source";import*as P from"react";import{Field as se}from"formik";import{AsyncPaginate as le}from"react-select-async-paginate";var ne=r=>{let{...e}=r;return React.createElement(le,{additional:{page:1},...e})},q=ne;var pe=r=>{let{name:e,label:i,onChange:t,...o}=r;return P.createElement(se,{name:e},n=>{let{field:c,meta:a,form:l}=n,m=a.touched&&!!a.error;return P.createElement(F,{isError:m,error:a.error,label:i},P.createElement(q,{...o,...c,onBlur:()=>l.setFieldTouched(e,!0),onChange:s=>{t&&t(s),l.setFieldValue(e,s)}}))})},H=pe;var me=({type:r,name:e,valueOptions:i,loadOptions:t})=>{switch(r){case U:return g.createElement(H,{name:e,isMulti:!0,loadOptions:t});case(M||k||D||_||V):return g.createElement(y,{name:e,isMulti:!0});case _:return g.createElement(y,{name:e,options:i,isMulti:!0});default:return g.createElement(y,{name:e,isMulti:!0})}},B=me;var ce=r=>{let{idOptions:e,loadOptions:i,operatorOptions:t,type:o,valueOptions:n,onRemove:c,onChangeIdSelect:a,index:l}=r;return u.createElement("div",{className:"filter-row"},u.createElement("div",{className:"filter-row__field filter-row__field__id"},u.createElement(y,{name:`filters[${l}].id`,options:e,onChange:a})),u.createElement("div",{className:"filter-row__field filter-row__field__operator"},u.createElement(w,{name:`filters[${l}].operator`,options:t})),u.createElement("div",{className:"filter-row__field filter-row__field__values"},u.createElement(B,{name:`filters[${l}].values`,type:o,valueOptions:n,loadOptions:i}),o),u.createElement("div",{className:"filter-row__field filter-row__remove"},u.createElement("button",{type:"button",onClick:()=>c(l)},"\u0432\u0438\u0434\u0430\u043B\u0438\u0442\u0438")))},$=ce;var j=(r,e)=>({filters:r.filters?.length?r.filters.map(t=>{let o=e.find(n=>t.id.value===n.value);return{values:t.values,operator:t.operator,id:o}}):[]}),z=r=>r.map(e=>{let{caption:i,id:t,values:o,operators:n,...c}=e,a;Array.isArray(o)?a=o.map(m=>({label:m.name,value:String(m.id)})):a=o;let l=n.map(m=>({key:m,value:m}));return{label:i,value:String(t),values:a,operators:[{key:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440",value:""},...l],...c}});var Fe=r=>{let{onSubmitFilterForm:e,initialFilters:i,filtersTypesList:t,onRemoveFilter:o,onAddFilter:n,onLoadSourceOptions:c}=r,a=z(t),l=j(i,a);return d.createElement(fe,{onSubmit:(s,b)=>{let O={filters:s.filters.map(T=>{let{id:I,...A}=T;return{...A,id:{label:I.label,value:I.value}}})};e&&e(O)},initialValues:l,validationSchema:x,enableReinitialize:!0},d.createElement(ue,null,d.createElement(de,{name:"filters"},s=>{let{form:b,push:E,remove:O}=s,{filters:T}=b.values,I=f=>{O(f),o&&o(f)},A=()=>{let[f=null]=a;E({id:f,operator:"",values:[]}),n&&n(s)};return d.createElement("div",{className:"filter-list"},d.createElement("ul",{className:"filter-list__items"},T.map((f,C)=>{let W=ye=>{b.setFieldValue(`filters[${C}].operator`,""),b.setFieldValue(`filters[${C}].values`,null)};return d.createElement("li",{className:"filter-list__item",key:C},d.createElement($,{loadOptions:c(f?.id?.value),type:f?.id?.type,onChangeIdSelect:W,idOptions:a,operatorOptions:f?.id?.operators,valueOptions:f?.id?.values,onRemove:I,index:C}))})),d.createElement("div",{className:"filter-list__button"},d.createElement("button",{type:"button",onClick:A},"add one more filter")))}),d.createElement("button",{type:"submit"},"\u0417\u0430\u0441\u0442\u0443\u0441\u0443\u0432\u0430\u0442\u0438 \u0444\u0456\u043B\u044C\u0442\u0440")))},G=Fe;export{G as TableFiltersClient};
//# sourceMappingURL=index.js.map
