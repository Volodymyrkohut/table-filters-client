import*as u from"react";import{FieldArray as Fe,Form as Re,Formik as be}from"formik";import*as a from"yup";var A=e=>e?.map(t=>t.value),y={required:"Required",date:"Should be valid date format",string:"Should be valid string",number:"Should be valid number"},Z=a.object().shape({filters:a.array().of(a.object().shape({id:a.object().shape({label:a.string().required(),value:a.string().required(),type:a.string().required()}).nullable().required(y.required),values:a.array().when("id",{is:e=>e.type==="number",then:a.array().transform(e=>A(e)).of(a.number().typeError(y.number)).required(y.required)}).when("id",{is:e=>e.type==="date",then:a.array().transform(e=>A(e)).of(a.date().typeError(y.date)).required(y.required)}).when("id",{is:e=>e.type!=="date"&&e.type!=="number",then:a.array().transform(e=>A(e)).of(a.number().typeError(y.string)).required(y.required)}),operator:a.string().nullable().required(y.required)}))}),h=Z;import*as d from"react";import*as v from"react";var E="number",_="string",x="boolean",L="date",g="enum",Y="source";import*as C from"react";import{Field as ie}from"formik";import*as b from"react";import ee from"classnames";var te=e=>{let{children:t,label:i="",isError:r,error:o}=e,n=ee("field-control",{isError:r});return b.createElement("div",{className:n},i&&b.createElement("label",null,i),t,b.createElement("span",{className:"field-control__error"},r&&b.createElement("span",null,o)))},F=te;import*as N from"react";import{AsyncPaginate as re}from"react-select-async-paginate";var oe=e=>{let{...t}=e;return N.createElement(re,{additional:{page:1},...t})},w=oe;var ae=e=>{let{name:t,label:i,onChange:r,...o}=e;return C.createElement(ie,{name:t},n=>{let{field:c,meta:l,form:s}=n,m=l.touched&&!!l.error;return C.createElement(F,{isError:m,error:l.error,label:i},C.createElement(w,{...o,...c,onBlur:()=>s.setFieldTouched(t,!0),onChange:p=>{r&&r(p),s.setFieldValue(t,p)}}))})},V=ae;import*as O from"react";import{Field as se}from"formik";import*as D from"react";import le from"react-select/async-creatable";var ne=function(e){let{options:t,isError:i,...r}=e;return D.createElement(le,{defaultOptions:t,...r})},q=ne;var pe=e=>{let{name:t,label:i,onChange:r,...o}=e;return O.createElement(se,{name:t},n=>{let{field:c,meta:l,form:s}=n,m=l.touched&&!!l.error;return O.createElement(F,{isError:m,error:l.error,label:i},O.createElement(q,{...o,...c,onBlur:()=>s.setFieldTouched(t,!0),onChange:p=>{r&&r(p),s.setFieldValue(t,p)}}))})},R=pe;var me=({type:e,name:t,valueOptions:i,loadOptions:r})=>{switch(e){case Y:return v.createElement(V,{name:t,isMulti:!0,loadOptions:r});case(_||x||L||g||E):return v.createElement(R,{name:t,isMulti:!0});case g:return v.createElement(R,{name:t,options:i,isMulti:!0});default:return v.createElement(R,{name:t,isMulti:!0})}},U=me;import*as S from"react";import{Field as de}from"formik";import k from"react";import ce from"classnames";var ue=e=>{let{isError:t,children:i,...r}=e,o=ce("select",{isError:t});return k.createElement("div",{className:o},k.createElement("select",{autoComplete:"off",...r},i))},M=ue;var fe=e=>{let{name:t,options:i=[],disabled:r,label:o,id:n}=e;return S.createElement(de,{name:t},c=>{let{field:l,meta:s}=c,m=s.touched&&!!s.error;return S.createElement(F,{isError:m,error:s.error,label:o},S.createElement(M,{id:n,...l,isError:m,disabled:r},i.map(p=>S.createElement("option",{key:p.value,value:p.value},p.key))))})},B=fe;var ye=e=>{let{idOptions:t,loadOptions:i,operatorOptions:r,filterType:o,valueOptions:n,onRemove:c,onChangeIdSelect:l,index:s}=e;return d.createElement("div",{className:"filter-row"},d.createElement("div",{className:"filter-row__field filter-row__field__id"},d.createElement(R,{name:`filters[${s}].id`,options:t,onChange:l})),d.createElement("div",{className:"filter-row__field filter-row__field__operator"},d.createElement(B,{name:`filters[${s}].operator`,options:r})),d.createElement("div",{className:"filter-row__field filter-row__field__values"},d.createElement(U,{name:`filters[${s}].values`,type:o,valueOptions:n,loadOptions:i})),d.createElement("div",{className:"filter-row__field filter-row__remove"},d.createElement("button",{type:"button",onClick:()=>c(s)},"\u0432\u0438\u0434\u0430\u043B\u0438\u0442\u0438")))},H=ye;var $=(e,t)=>({filters:e.filters?.length?e.filters.map(r=>{let o=t.find(n=>r.id.value===n.value);return{values:r.values,operator:r.operator,id:o}}):[]}),W=e=>e.map(t=>{let{caption:i,id:r,values:o,operators:n,...c}=t,l;Array.isArray(o)?l=o.map(m=>({label:m.name,value:String(m.id)})):l=o;let s=n.map(m=>({key:m,value:m}));return{label:i,value:String(r),values:l,operators:[{key:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440",value:""},...s],...c}}),j=e=>({filters:e.filters.map(r=>{let{id:o,...n}=r;return{...n,id:{label:o.label,value:o.value}}})});var ve=e=>{let{onSubmitFilterForm:t,initialFilters:i,filtersTypesList:r,onRemoveFilter:o,onAddFilter:n,onLoadSourceOptions:c}=e,l=W(r),s=$(i,l);return u.createElement(be,{onSubmit:(p,T)=>{let P=j(p);t&&t(P)},initialValues:s,validationSchema:h,enableReinitialize:!0},u.createElement(Re,null,u.createElement(Fe,{name:"filters"},p=>{let{form:T,push:P,remove:G}=p,{filters:J}=T.values,K=f=>{G(f),o&&o(f)},Q=()=>{let[f=null]=l;P({id:f,operator:"",values:[]}),n&&n(p)};return u.createElement("div",{className:"filter-list"},u.createElement("ul",{className:"filter-list__items"},J.map((f,I)=>{let X=()=>{T.setFieldValue(`filters[${I}].operator`,""),T.setFieldValue(`filters[${I}].values`,null)};return u.createElement("li",{className:"filter-list__item",key:I},u.createElement(H,{loadOptions:c(f?.id?.value),filterType:f?.id?.type,onChangeIdSelect:X,idOptions:l,operatorOptions:f?.id?.operators,valueOptions:f?.id?.values,onRemove:K,index:I}))})),u.createElement("div",{className:"filter-list__button"},u.createElement("button",{type:"button",onClick:Q},"add one more filter")))}),u.createElement("button",{type:"submit"},"\u0417\u0430\u0441\u0442\u0443\u0441\u0443\u0432\u0430\u0442\u0438 \u0444\u0456\u043B\u044C\u0442\u0440")))},z=ve;export{z as TableFiltersClient};
//# sourceMappingURL=index.js.map
