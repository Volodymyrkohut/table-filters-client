import*as d from"react";import{FieldArray as ue,Form as fe,Formik as Fe}from"formik";import*as p from"yup";var K=p.object().shape({filters:p.array().of(p.object().shape({id:p.object().shape({label:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),value:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F")}).nullable().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),values:p.array().of(p.object().shape({label:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),value:p.string().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F")})).nullable().min(1,"\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F").required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F"),operator:p.string().nullable().required("\u0426\u0435 \u043F\u043E\u043B\u0435 \u0454 \u043E\u0431\u043E\u0432\u044F\u0437\u043A\u043E\u0432\u0438\u043C \u0434\u043B\u044F \u0437\u0430\u043F\u043E\u0432\u043D\u0435\u043D\u043D\u044F")}))}),x=K;import*as u from"react";import*as R from"react";var h="number",L="string",N="boolean",Y="date",_="enum",w="source";import*as P from"react";import{Field as te}from"formik";import*as v from"react";import Q from"classnames";var X=r=>{let{children:e,label:a="",isError:t,error:o}=r,n=Q("field-control",{isError:t});return v.createElement("div",{className:n},a&&v.createElement("label",null,a),e,v.createElement("span",{className:"field-control__error"},t&&v.createElement("span",null,o)))},F=X;import*as V from"react";import{AsyncPaginate as Z}from"react-select-async-paginate";var ee=r=>{let{...e}=r;return V.createElement(Z,{additional:{page:1},...e})},k=ee;var re=r=>{let{name:e,label:a,onChange:t,...o}=r;return P.createElement(te,{name:e},n=>{let{field:c,meta:i,form:l}=n,m=i.touched&&!!i.error;return P.createElement(F,{isError:m,error:i.error,label:a},P.createElement(k,{...o,...c,onBlur:()=>l.setFieldTouched(e,!0),onChange:s=>{t&&t(s),l.setFieldValue(e,s)}}))})},D=re;import*as g from"react";import{Field as ie}from"formik";import*as M from"react";import oe from"react-select/async-creatable";var ae=function(r){let{options:e,isError:a,...t}=r;return M.createElement(oe,{defaultOptions:e,...t})},U=ae;var le=r=>{let{name:e,label:a,onChange:t,...o}=r;return g.createElement(ie,{name:e},n=>{let{field:c,meta:i,form:l}=n,m=i.touched&&!!i.error;return g.createElement(F,{isError:m,error:i.error,label:a},g.createElement(U,{...o,...c,onBlur:()=>l.setFieldTouched(e,!0),onChange:s=>{t&&t(s),l.setFieldValue(e,s)}}))})},y=le;var ne=({type:r,name:e,valueOptions:a,loadOptions:t})=>{switch(r){case w:return R.createElement(D,{name:e,isMulti:!0,loadOptions:t});case(L||N||Y||_||h):return R.createElement(y,{name:e,isMulti:!0});case _:return R.createElement(y,{name:e,options:a,isMulti:!0});default:return R.createElement(y,{name:e,isMulti:!0})}},q=ne;import*as b from"react";import{Field as me}from"formik";import B from"react";import se from"classnames";var pe=r=>{let{isError:e,children:a,...t}=r,o=se("select",{isError:e});return B.createElement("div",{className:o},B.createElement("select",{autoComplete:"off",...t},a))},H=pe;var ce=r=>{let{name:e,options:a=[],disabled:t,label:o,id:n}=r;return b.createElement(me,{name:e},c=>{let{field:i,meta:l}=c,m=l.touched&&!!l.error;return b.createElement(F,{isError:m,error:l.error,label:o},b.createElement(H,{id:n,...i,isError:m,disabled:t},a.map(s=>b.createElement("option",{key:s.value,value:s.value},s.key))))})},$=ce;var de=r=>{let{idOptions:e,loadOptions:a,operatorOptions:t,type:o,valueOptions:n,onRemove:c,onChangeIdSelect:i,index:l}=r;return u.createElement("div",{className:"filter-row"},u.createElement("div",{className:"filter-row__field filter-row__field__id"},u.createElement(y,{name:`filters[${l}].id`,options:e,onChange:i})),u.createElement("div",{className:"filter-row__field filter-row__field__operator"},u.createElement($,{name:`filters[${l}].operator`,options:t})),u.createElement("div",{className:"filter-row__field filter-row__field__values"},u.createElement(q,{name:`filters[${l}].values`,type:o,valueOptions:n,loadOptions:a}),o),u.createElement("div",{className:"filter-row__field filter-row__remove"},u.createElement("button",{type:"button",onClick:()=>c(l)},"\u0432\u0438\u0434\u0430\u043B\u0438\u0442\u0438")))},j=de;var z=(r,e)=>({filters:r.filters?.length?r.filters.map(t=>{let o=e.find(n=>t.id.value===n.value);return{values:t.values,operator:t.operator,id:o}}):[]}),G=r=>r.map(e=>{let{caption:a,id:t,values:o,operators:n,...c}=e,i;Array.isArray(o)?i=o.map(m=>({label:m.name,value:String(m.id)})):i=o;let l=n.map(m=>({key:m,value:m}));return{label:a,value:String(t),values:i,operators:[{key:"\u0412\u0438\u0431\u0435\u0440\u0456\u0442\u044C \u043E\u043F\u0435\u0440\u0430\u0442\u043E\u0440",value:""},...l],...c}});var ye=r=>{let{onSubmitFilterForm:e,initialFilters:a,filtersTypesList:t,onRemoveFilter:o,onAddFilter:n,onLoadSourceOptions:c}=r,i=G(t),l=z(a,i);return d.createElement(Fe,{onSubmit:(s,I)=>{let O={filters:s.filters.map(T=>{let{id:S,...A}=T;return{...A,id:{label:S.label,value:S.value}}})};e&&e(O)},initialValues:l,validationSchema:x,enableReinitialize:!0},d.createElement(fe,null,d.createElement(ue,{name:"filters"},s=>{let{form:I,push:E,remove:O}=s,{filters:T}=I.values,S=f=>{O(f),o&&o(f)},A=()=>{let[f=null]=i;E({id:f,operator:"",values:[]}),n&&n(s)};return d.createElement("div",{className:"filter-list"},d.createElement("ul",{className:"filter-list__items"},T.map((f,C)=>{let J=ve=>{I.setFieldValue(`filters[${C}].operator`,""),I.setFieldValue(`filters[${C}].values`,null)};return d.createElement("li",{className:"filter-list__item",key:C},d.createElement(j,{loadOptions:c(f?.id?.value),type:f?.id?.type,onChangeIdSelect:J,idOptions:i,operatorOptions:f?.id?.operators,valueOptions:f?.id?.values,onRemove:S,index:C}))})),d.createElement("div",{className:"filter-list__button"},d.createElement("button",{type:"button",onClick:A},"add one more filter")))}),d.createElement("button",{type:"submit"},"\u0417\u0430\u0441\u0442\u0443\u0441\u0443\u0432\u0430\u0442\u0438 \u0444\u0456\u043B\u044C\u0442\u0440")))},W=ye;export{W as TableFiltersClient};
//# sourceMappingURL=index.js.map
